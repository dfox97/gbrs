---
import { Image } from 'astro:assets';
import { PROJECT_CATEGORIES } from '../consts';

interface Props {
  project: any;
}

const { project } = Astro.props;

// Helper to get optimized gallery URLs
function getGallerySrcs(proj: any) {
  if (!proj.data.gallery) return [];
  return proj.data.gallery.map((imgMeta: any) => imgMeta.src);
}

const gallerySrcs = getGallerySrcs(project);
const categoryLabel = PROJECT_CATEGORIES[project.data.category as keyof typeof PROJECT_CATEGORIES] || project.data.category;
---

<article class="project-card" data-category={project.data.category}>
  <div class="project-images">
    <Image 
      src={project.data.thumbnail} 
      alt={project.data.title} 
      width={600} height={400} 
      class="project-main-img"
    />
    <div class="project-badge">{categoryLabel}</div>
  </div>
  <div class="project-info">
    <h3>{project.data.title}</h3>
    <p class="project-description">
      {project.data.description}
    </p>
    
    {/* Slot for extra content like highlights lists used in service pages */}
    <slot />

    {gallerySrcs && gallerySrcs.length > 0 && (
      <button 
        class="view-gallery-btn" 
        data-title={project.data.title}
        data-gallery={JSON.stringify(gallerySrcs)}
      >
        View Gallery ({gallerySrcs.length} photos) â†’
      </button>
    )}
  </div>
</article>

<style>
.project-card{background:white;border-radius:12px;overflow:hidden;box-shadow:0 4px 12px rgba(0,0,0,0.08);transition:all 0.3s ease;display:flex;flex-direction:column;}
.project-card:hover{transform:translateY(-8px);box-shadow:0 8px 24px rgba(0,0,0,0.15);}
.project-images{position:relative;overflow:hidden;aspect-ratio:3/2;}
.project-main-img{width:100%;height:100%;object-fit:cover;transition:transform 0.3s ease;}
.project-card:hover .project-main-img{transform:scale(1.05);}
.project-info{padding:24px;display:flex;flex-direction:column;flex-grow:1;}
.project-info h3{color:var(--primary);font-size:1.3rem;font-weight:700;margin-bottom:12px;}
.project-description{color:#555;font-size:0.95rem;line-height:1.6;margin-bottom:16px;}
.view-gallery-btn{background:var(--primary);color:white;border:none;padding:10px 16px;border-radius:6px;cursor:pointer;font-size:0.9rem;transition:background 0.3s ease;}
.view-gallery-btn:hover{background:var(--primary-dark);} 
</style>
