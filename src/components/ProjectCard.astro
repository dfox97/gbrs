---
import { Image, getImage } from 'astro:assets';

interface Props {
  project: any;
}

const { project } = Astro.props;

// Helper to get optimized gallery URLs
async function getGallerySrcs(proj) {
  if (!proj.data.gallery) return [];
  return await Promise.all(proj.data.gallery.map(async (imgMeta) => {
    const optimized = await getImage({src: imgMeta});
    return optimized.src;
  }));
}

const gallerySrcs = await getGallerySrcs(project);

function formatCategory(cat: string) {
  const map: Record<string, string> = {
    'agricultural': 'Agricultural',
    'industrial': 'Industrial',
    'recladding': 'Recladding',
    'groundworks': 'Groundworks',
    'new-build': 'New Build'
  };
  return map[cat] || cat.charAt(0).toUpperCase() + cat.slice(1);
}
---

<article class="project-card" data-category={project.data.category}>
  <div class="project-images">
    <Image 
      src={project.data.thumbnail} 
      alt={project.data.title} 
      width={600} height={400} 
      class="project-main-img"
    />
    <div class="project-badge">{formatCategory(project.data.category)}</div>
  </div>
  <div class="project-info">
    <h3>{project.data.title}</h3>
    <p class="project-description">
      {project.data.description}
    </p>
    
    {/* Slot for extra content like highlights lists used in service pages */}
    <slot />

    {gallerySrcs && gallerySrcs.length > 0 && (
      <button 
        class="view-gallery-btn" 
        data-title={project.data.title}
        data-gallery={JSON.stringify(gallerySrcs)}
      >
        View Gallery ({gallerySrcs.length} photos) â†’
      </button>
    )}
  </div>
</article>
