---
import { Image } from 'astro:assets';
import { PROJECT_CATEGORIES } from '../consts';

interface Props {
  project: any;
}

const { project } = Astro.props;

// Helper to get optimized gallery URLs
function getGallerySrcs(proj: any) {
  if (!proj.data.gallery) return [];
  return proj.data.gallery.map((imgMeta: any) => imgMeta.src);
}

const gallerySrcs = getGallerySrcs(project);
const categoryLabel = PROJECT_CATEGORIES[project.data.category as keyof typeof PROJECT_CATEGORIES] || project.data.category;
---

<article class="project-card" data-category={project.data.category}>
  <div class="project-images">
    <Image 
      src={project.data.thumbnail} 
      alt={project.data.title} 
      width={600} height={400} 
      class="project-main-img"
    />
    <div class="project-badge">{categoryLabel}</div>
  </div>
  <div class="project-info">
    <h3>{project.data.title}</h3>
    <p class="project-description">
      {project.data.description}
    </p>
    
    {/* Slot for extra content like highlights lists used in service pages */}
    <slot />

    {gallerySrcs && gallerySrcs.length > 0 && (
      <button 
        class="view-gallery-btn" 
        data-lightbox-open
        data-title={project.data.title}
        data-images={JSON.stringify(gallerySrcs)}
        data-start-index="0"
      >
        View Gallery ({gallerySrcs.length} photos) â†’
      </button>
    )}
  </div>
</article>
